service: api-students

provider:
  name: aws
  runtime: java8
  profile: ${opt:profile, 'uvsy-dev'}
  stage: ${opt:stage, 'dev2'}
  region: ${opt:region, 'sa-east-1'}
  deploymentBucket: ${self:provider.stage}.${self:provider.region}.universy.serverless.deploys
  deploymentPrefix: ${self:provider.region}
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "dynamodb:*"
      Resource: "*"
  environment:
    STAGE: ${self:provider.stage}

plugins:
  - serverless-offline
  - serverless-domain-manager


package:
  artifact: build/distributions/${self:service}-1.0.zip


custom:

  # Domain name configuration
  customDomain:
    domainName: students-api-${self:provider.stage}.compute.universy.app
    stage: ${self:provider.stage}
    endpointType: "regional"
    hostedZoneId: ${ssm:/all/route53/zones/compute/id~true}
    certificateArn: ${ssm:/all/acm/cert/compute/arn~true}
    createRoute53Record: true
    apiType: REST

  # Prune
  prune:
    automatic: true
    number: 3

functions:
  - ${file(./sls/functions/api_student.yml)}

resources:
 - ${file(./sls/resources/profile_dynamo_db_table.yml)}
 - ${file(./sls/resources/career_dynamo_db_table.yml)}
 - ${file(./sls/resources/note_dynamo_db_table.yml)}
 - ${file(./sls/resources/event_dynamo_db_table.yml)}
 - ${file(./sls/resources/subject_dynamo_db_table.yml)}
